/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var O=Object.defineProperty;var Y=Object.getOwnPropertyDescriptor;var Z=Object.getOwnPropertyNames;var J=Object.prototype.hasOwnProperty;var K=(n,s)=>{for(var e in s)O(n,e,{get:s[e],enumerable:!0})},Q=(n,s,e,t)=>{if(s&&typeof s=="object"||typeof s=="function")for(let i of Z(s))!J.call(n,i)&&i!==e&&O(n,i,{get:()=>s[i],enumerable:!(t=Y(s,i))||t.enumerable});return n};var X=n=>Q(O({},"__esModule",{value:!0}),n);var ae={};K(ae,{PdfEmbedPlugin:()=>B,default:()=>oe});module.exports=X(ae);var I=require("obsidian");function z(n,s){n.addCommand({id:"embed-pdf-new-file",name:"Embed PDF document (new file)",checkCallback:e=>(e||s.embedPdfAsNewNote(),!0)}),n.addCommand({id:"embed-pdf-at-cursor",name:"Embed PDF at cursor",editorCallback:e=>{s.embedPdfAtCursor(e)}}),n.addCommand({id:"embed-current-pdf",name:"Embed currently opened PDF",editorCallback:e=>{s.embedCurrentPdf(e)}}),n.addCommand({id:"embed-pdfs-from-directory",name:"Embed PDFs from directory",checkCallback:e=>(e||s.embedPdfsFromDirectory(),!0)})}var w=require("obsidian");function x(n,s,e){let t=s.map(a=>`![[${a}]]`).join(`

`);if(e.length===0)return t;if(n.tagsInFrontmatter)return`${`---
tags:
${e.map(r=>`  - ${r}`).join(`
`)}
---

`}${t}`;let i=e.map(a=>`#${a}`).join(" ");return`${t}

${i}`}var p=require("obsidian"),P=class extends p.FuzzySuggestModal{constructor(e,t){super(e);this.onSelect=t,this.setPlaceholder("Select a PDF file to embed")}getItems(){return this.app.vault.getFiles().filter(e=>{var t;return((t=e.extension)==null?void 0:t.toLowerCase())==="pdf"})}getItemText(e){return e.path}onChooseItem(e){this.onSelect(e)}},S=class extends p.FuzzySuggestModal{constructor(e,t,i){super(e);this.hasSelected=!1;this.onSelect=t,this.setPlaceholder(i)}getItems(){return this.app.vault.getAllLoadedFiles().filter(e=>e instanceof p.TFolder)}getItemText(e){return e.path}onChooseItem(e){this.hasSelected=!0,this.onSelect(e)}onClose(){super.onClose(),this.hasSelected||this.onSelect(null)}},F=class extends p.Modal{constructor(e,t,i){super(e);this.selectedPdfs=new Set;this.pdfFiles=t,this.onSelect=i}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Select PDFs to Embed"});let t=e.createDiv(),i=t.createEl("input",{type:"checkbox"});t.createEl("label",{text:"Select All"}),i.onchange=()=>{e.querySelectorAll(".pdf-checkbox").forEach(r=>{r.checked=i.checked;let l=r.dataset.filepath;if(!l)return;let d=this.pdfFiles.find(h=>h.path===l);d&&(r.checked?this.selectedPdfs.add(d):this.selectedPdfs.delete(d))})},this.pdfFiles.forEach(o=>{let r=e.createDiv(),l=r.createEl("input",{type:"checkbox",cls:"pdf-checkbox"});l.dataset.filepath=o.path,r.createEl("label",{text:o.name}),l.onchange=()=>{l.checked?this.selectedPdfs.add(o):this.selectedPdfs.delete(o)}});let a=e.createEl("button",{text:"Embed Selected"});a.onclick=()=>{this.onSelect(Array.from(this.selectedPdfs)),this.close()}}onClose(){this.contentEl.empty()}},D=class extends p.Modal{constructor(e,t){super(e);this.onSelect=t}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Create a single combined MD file, or one MD file per PDF?"});let t=e.createEl("button",{text:"Single file"});t.onclick=()=>{this.onSelect("single"),this.close()};let i=e.createEl("button",{text:"Multiple files"});i.onclick=()=>{this.onSelect("multiple"),this.close()}}onClose(){this.contentEl.empty()}},y=class extends p.Modal{constructor(e,t){super(e);this.onSubmit=t}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Enter file name (without extension)"});let t=e.createEl("input",{type:"text"}),i=e.createEl("button",{text:"Create"});i.onclick=()=>{this.onSubmit(t.value),this.close()}}onClose(){this.contentEl.empty()}},N=class extends p.Modal{constructor(e,t,i){super(e);this.resolved=!1;this.filePath=t,this.onDecision=i}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Duplicate note detected"}),e.createEl("p",{text:`A note already exists at "${this.filePath}".`}),e.createEl("p",{text:"Do you want to create an additional copy with a new name?"});let t=e.createDiv({cls:"pdf-duplicate-modal-buttons"}),i=t.createEl("button",{text:"Create copy"});i.onclick=()=>this.finish(!0);let a=t.createEl("button",{text:"Cancel"});a.onclick=()=>this.finish(!1)}onClose(){this.contentEl.empty(),this.resolved||this.onDecision(!1)}finish(e){this.resolved||(this.resolved=!0,this.onDecision(e),this.close())}},C=class extends p.Modal{constructor(e,t,i,a){super(e);this.hasSubmitted=!1;this.suggestedTags=t,this.onSubmit=i,this.onCancel=a}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Select tags"});let t=new Set;this.suggestedTags.forEach(o=>{let r=e.createDiv(),l=r.createEl("input",{type:"checkbox"});r.createEl("label",{text:o}),l.onchange=()=>{l.checked?t.add(o):t.delete(o)}});let i=e.createEl("input",{type:"text",placeholder:"Add custom tags (comma-separated)"}),a=e.createEl("button",{text:"Add tags"});a.onclick=()=>{this.hasSubmitted=!0,i.value.split(",").map(r=>r.trim()).filter(r=>r!=="").forEach(r=>t.add(r)),this.onSubmit(Array.from(t)),this.close()}}onClose(){this.contentEl.empty(),!this.hasSubmitted&&this.onCancel&&this.onCancel()}};function L(n){if(!n)return"";let t=n.replace(/\\/g,"/").trim().replace(/\/+/g,"/").replace(/^\/+|\/+$/g,"");if(!t)return"";let i=t.split("/"),a=[];for(let o of i)if(!(!o||o===".")){if(o===".."){a.length>0&&a.pop();continue}a.push(o)}return a.join("/")}function ee(n,s){let t=(n!=null?n:"").trim().replace(/[\\/:*?"<>|]/g,"").replace(/\s+/g," ").trim();return t.length>0?t:s}function te(n){return n.toLowerCase().endsWith(".md")?n:`${n}.md`}async function U(n,s){if(!s)return;let e=n.vault.adapter;await e.exists(s)||await e.mkdir(s)}async function se(n,s){let e=n.vault.adapter;if(!await e.exists(s))return s;let t=s.lastIndexOf("."),i=t>s.lastIndexOf("/"),a=i?s.substring(t):"",o=i?s.substring(0,t):s,r=1,l=`${o} ${r}${a}`;for(;await e.exists(l);)r+=1,l=`${o} ${r}${a}`;return l}async function ie(n,s){return new Promise(e=>{new N(n,s,i=>{e(i)}).open()})}async function A({app:n,settings:s,showNotice:e,folderPath:t,fileName:i,fallbackName:a}){let o=L(t),r=ee(i,a),l=te(r),d=o?`${o}/${l}`:l;if(!await n.vault.adapter.exists(d))return o&&await U(n,o),d;let v=s.duplicateNoteBehavior;return v==="disallow"?(e(`A note already exists at "${d}". Duplicate creation is disabled.`),null):v==="warn"&&!await ie(n,d)?(e(`Duplicate note creation cancelled for "${d}".`),null):(o&&await U(n,o),se(n,d))}function T(n){let s=n.trim().replace(/^#+/,"");return s?s.replace(/\s+/g,"-").replace(/[^A-Za-z0-9/_-]/g,"").replace(/-{2,}/g,"-").replace(/^[-_/]+|[-_/]+$/g,""):""}function j(n){return n?n.split(",").map(s=>T(s)).filter(s=>s.length>0):[]}function W(n,s){let e=s.map(t=>T(t)).filter(t=>t.length>0);return Array.from(new Set([...n,...e]))}function ne(n){return j(n.tags)}async function _(n,s,e){if(!s.suggestTagsFromPath)return[];let t=new Set;for(let a of e){let o=a.path.split("/");o.pop();for(let r of o){let l=T(r);l.length>0&&t.add(l)}}let i=Array.from(t).sort((a,o)=>a.localeCompare(o));return i.length===0?[]:new Promise(a=>{let o=!1;new C(n,i,l=>{o||(o=!0,a(l.map(d=>T(d)).filter(d=>d.length>0)))},()=>{o||(o=!0,a([]))}).open()})}function H(n,s){let e=ne(n);return W(e,s)}var k=class{constructor(s){this.host=s;this.lastActivePdf=null}setLastActivePdf(s){this.lastActivePdf=s}async embedPdfAsNewNote(){new P(this.host.app,async s=>{var l;if(!s)return;let e=await _(this.host.app,this.host.settings,[s]),t=H(this.host.settings,e),i=x(this.host.settings,[s.path],t),a=this.host.settings.fileNameTemplate.replace("{{pdf_name}}",s.basename),o=`Embedded PDF - ${s.basename}`,r=this.host.settings.defaultEmbedDirectory||((l=s.parent)==null?void 0:l.path)||"";try{let d=await A({app:this.host.app,settings:this.host.settings,showNotice:m=>this.host.showNotice(m),folderPath:r,fileName:a,fallbackName:o});if(!d)return;let h=await this.host.app.vault.create(d,i);this.host.app.workspace.openLinkText(h.path,h.path,!0),this.host.showNotice(`Embedded ${s.name} into ${d}`)}catch(d){console.error("pdf-embed: failed to create embedded note",d);let h=d instanceof Error?d.message:"Unknown error";new w.Notice(`Failed to embed ${s.name}: ${h}`)}}).open()}embedPdfAtCursor(s){new P(this.host.app,e=>{if(!e)return;let t=this.host.settings.embedAtCursorTemplate.replace("{{pdf_path}}",e.path);s.replaceSelection(t),this.host.showNotice(`Embedded ${e.name}`)}).open()}embedCurrentPdf(s){if(this.lastActivePdf){let e=`![[${this.lastActivePdf.path}]]`;s.replaceSelection(e),this.host.showNotice(`Embedded ${this.lastActivePdf.name}`)}else this.host.showNotice("No PDF file is currently open.")}embedPdfsFromDirectory(){new S(this.host.app,async s=>{if(!s)return;let e=s.children.filter(t=>{var i;return t instanceof w.TFile&&((i=t.extension)==null?void 0:i.toLowerCase())==="pdf"});if(e.length===0){this.host.showNotice(`No PDF files found in ${s.path}`);return}new F(this.host.app,e,async t=>{if(t.length===0){this.host.showNotice("No PDFs selected for embedding.");return}let i=await _(this.host.app,this.host.settings,t),a=H(this.host.settings,i),o=r=>{var h;let l=async m=>{var M,V;if(m===null){this.host.showNotice("No destination folder selected. PDFs not embedded.");return}let v=(V=(M=t[0])==null?void 0:M.basename)!=null?V:"Embedded PDF";if(r==="single")new y(this.host.app,async g=>{let f=g&&g.trim()!==""?g:v;try{let u=await A({app:this.host.app,settings:this.host.settings,showNotice:b=>this.host.showNotice(b),folderPath:m,fileName:f,fallbackName:v});if(!u)return;let E=x(this.host.settings,t.map(b=>b.path),a);await this.host.app.vault.create(u,E),this.host.showNotice(`Embedded ${t.length} PDF(s) into ${u}`)}catch(u){console.error("pdf-embed: failed to create combined embed note",u);let E=u instanceof Error?u.message:"Unknown error";new w.Notice(`Failed to create combined note: ${E}`)}}).open();else try{for(let f of t){let u=this.host.settings.fileNameTemplate.replace("{{pdf_name}}",f.basename),E=`Embedded PDF - ${f.basename}`,b=await A({app:this.host.app,settings:this.host.settings,showNotice:R=>this.host.showNotice(R),folderPath:m,fileName:u,fallbackName:E});if(!b)return;let G=x(this.host.settings,[f.path],a);await this.host.app.vault.create(b,G)}let g=L(m)||"vault root";this.host.showNotice(`Embedded ${t.length} PDF(s) into ${g}`)}catch(g){console.error("pdf-embed: failed during batch embed",g);let f=g instanceof Error?g.message:"Unknown error";new w.Notice(`Failed to embed PDFs: ${f}`)}},d=(h=this.host.settings.defaultEmbedDirectory)==null?void 0:h.trim();d?l(d):new S(this.host.app,m=>{l(m?m.path:null)},"Select a destination folder").open()};if(t.length===1){o("single");return}this.host.settings.batchEmbedMode==="ask"?new D(this.host.app,r=>o(r)).open():o(this.host.settings.batchEmbedMode)}).open()},"Select a folder containing PDF files").open()}};var c=require("obsidian"),$=class extends c.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){let{containerEl:e}=this;e.empty(),e.createEl("h2",{text:"PDF Embed Settings"}),new c.Setting(e).setName("Default embed directory").setDesc("The default directory to save embedded PDF files.").addText(t=>t.setPlaceholder("e.g. embeds").setValue(this.plugin.settings.defaultEmbedDirectory).onChange(async i=>{this.plugin.settings.defaultEmbedDirectory=i,await this.plugin.saveSettings()})),new c.Setting(e).setName("File name template").setDesc("Use {{pdf_name}} as a placeholder for the PDF file name.").addText(t=>t.setPlaceholder("e.g. Embedded PDF - {{pdf_name}}").setValue(this.plugin.settings.fileNameTemplate).onChange(async i=>{this.plugin.settings.fileNameTemplate=i,await this.plugin.saveSettings()})),new c.Setting(e).setName("Tags").setDesc("Comma-separated list of tags to add (enter without leading #; the plugin formats them).").addText(t=>t.setPlaceholder("e.g. pdf, reference").setValue(this.plugin.settings.tags).onChange(async i=>{this.plugin.settings.tags=i,await this.plugin.saveSettings()})),new c.Setting(e).setName("Add tags to frontmatter").setDesc("If enabled, tags are stored as a YAML list in front matter (no # prefix required).").addToggle(t=>t.setValue(this.plugin.settings.tagsInFrontmatter).onChange(async i=>{this.plugin.settings.tagsInFrontmatter=i,await this.plugin.saveSettings()})),new c.Setting(e).setName("Suggest tags from path").setDesc("If enabled, the plugin will suggest tags based on the PDF file path.").addToggle(t=>t.setValue(this.plugin.settings.suggestTagsFromPath).onChange(async i=>{this.plugin.settings.suggestTagsFromPath=i,await this.plugin.saveSettings()})),new c.Setting(e).setName("Default batch embed mode").setDesc("The default behavior when embedding multiple PDFs from a directory.").addDropdown(t=>t.addOption("ask","Ask every time").addOption("single","Create a single summary file").addOption("multiple","Create multiple files").setValue(this.plugin.settings.batchEmbedMode).onChange(async i=>{this.plugin.settings.batchEmbedMode=i,await this.plugin.saveSettings()})),new c.Setting(e).setName("Duplicate note handling").setDesc("Choose how to handle duplicate note names when embedding PDFs.").addDropdown(t=>t.addOption("allow","Allow (auto-rename)").addOption("warn","Warn before creating a copy").addOption("disallow","Disallow duplicates").setValue(this.plugin.settings.duplicateNoteBehavior).onChange(async i=>{this.plugin.settings.duplicateNoteBehavior=i,await this.plugin.saveSettings()})),new c.Setting(e).setName("Show notifications").setDesc("If enabled, the plugin will show a notification after embedding a PDF.").addToggle(t=>t.setValue(this.plugin.settings.showNotifications).onChange(async i=>{this.plugin.settings.showNotifications=i,await this.plugin.saveSettings()})),new c.Setting(e).setName("Embed at cursor template").setDesc("Template for the embed link when using the 'Embed at cursor' command. Use {{pdf_path}} as a placeholder.").addText(t=>t.setPlaceholder("e.g. ![[{{pdf_path}}]]").setValue(this.plugin.settings.embedAtCursorTemplate).onChange(async i=>{this.plugin.settings.embedAtCursorTemplate=i,await this.plugin.saveSettings()}))}};var q={defaultEmbedDirectory:"",fileNameTemplate:"Embedded PDF - {{pdf_name}}",tags:"",tagsInFrontmatter:!1,suggestTagsFromPath:!1,batchEmbedMode:"ask",showNotifications:!0,embedAtCursorTemplate:"![[{{pdf_path}}]]",duplicateNoteBehavior:"allow"};var B=class extends I.Plugin{async onload(){await this.loadSettings(),this.embedService=new k(this),this.addSettingTab(new $(this.app,this)),z(this,this.embedService),this.registerEvent(this.app.workspace.on("active-leaf-change",e=>{var t;if(e&&e.view&&e.view.getViewType()==="pdf"){let i=e.view;this.embedService.setLastActivePdf((t=i.file)!=null?t:null)}}))}onunload(){}showNotice(e){this.settings.showNotifications&&new I.Notice(e)}async loadSettings(){this.settings=Object.assign({},q,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}},oe=B;
